const APP_SHELL_CACHE_NAME="app-shell-v3",DYNAMIC_CACHE_NAME="dynamic-data-v3",API_BASE_URL="https://story-api.dicoding.dev/v1",APP_SHELL_URLS=[".","./index.html","./manifest.json","./favicon.png","./images/logo.png","./app.bundle.js","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png","https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Menginstal v3..."),e.waitUntil(caches.open("app-shell-v3").then((e=>(console.log("Service Worker: Caching App Shell"),e.addAll(APP_SHELL_URLS)))).then((()=>self.skipWaiting())).catch((e=>{console.error("Gagal caching App Shell:",e)})))})),self.addEventListener("activate",(e=>{console.log("Service Worker: Mengaktifkan v3..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>"app-shell-v3"!==e&&"dynamic-data-v3"!==e)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);if(t.href.startsWith(API_BASE_URL))return"GET"!==e.request.method?void e.respondWith(fetch(e.request)):void e.respondWith(fetch(e.request).then((t=>t&&t.ok?caches.open("dynamic-data-v3").then((a=>(a.put(e.request,t.clone()),t))):t)).catch((()=>(console.log("Service Worker: Network gagal, mengambil dari cache untuk:",t.pathname),caches.match(e.request)))));e.respondWith(caches.match(e.request).then((a=>a||fetch(e.request).then((a=>a&&a.ok?caches.open("app-shell-v3").then((i=>(t.origin===self.origin&&i.put(e.request,a.clone()),a))):a)).catch((()=>{console.warn("Service Worker: Aset gagal diambil:",e.request.url)})))))})),self.addEventListener("push",(e=>{let t;console.log("Service Worker: Push Diterima.");try{t=e.data.json()}catch(e){t={title:"Notifikasi Baru",body:"Ada konten baru untuk Anda.",icon:"favicon.png",data:{url:"#/"}}}const a=t.title||"Notifikasi Baru",i={body:t.body||"Ada pesan baru.",icon:t.icon||"favicon.png",badge:"favicon.png",data:{url:t.data?.url||"#/"},actions:[{action:"explore-action",title:"Lihat Sekarang"}]};e.waitUntil(self.registration.showNotification(a,i))})),self.addEventListener("notificationclick",(e=>{console.log("Service Worker: Notifikasi diklik."),e.notification.close();const t=e.notification.data.url||"#/";e.action,e.waitUntil(clients.openWindow(t))}));